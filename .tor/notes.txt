# assuming you already have tor installed
# Enable Tor at boot
sudo systemctl enable tor

# Append hidden service config safely
sudo tee -a /etc/tor/torrc > /dev/null <<EOL
HiddenServiceDir /var/lib/tor/my_hidden_service/
HiddenServicePort 8080 127.0.0.1:8080
EOL
HiddenServicePort 5173 127.0.0.1:5173

# Create hidden service directory
sudo mkdir -p /var/lib/tor/my_hidden_service
sudo chown -R tor:tor /var/lib/tor/my_hidden_service
sudo chmod 700 /var/lib/tor/my_hidden_service

# Restart Tor to apply changes
sudo systemctl restart tor

# Check the hostname (your .onion address)
sudo cat /var/lib/tor/my_hidden_service/hostname

# setup the onion url in the project
# from SmartServiceHub/SmartServiceHub
export ONION_URL=$(sudo cat /var/lib/tor/my_hidden_service/hostname)
echo "VITE_ONION_URL=$ONION_URL" > SmartServiceHub-frontend/src/frontend/src/.env.local

# Verify Tor status
systemctl status tor
